/*!
  * fe-analytics v0.2.8
  * © 2019 tujiaFE
  */
var feAnalyticsWeb=function(){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var t,e,o,r,i,s,d=function(){return(d=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=function(t){var e=t.pid,n=t.pageName,o=t.url,r=t.path,i=t.ref,s=t.pext,a=t.refPid;this.pid=e,this.pageName=n,this.url=o,this.path=r,this.ref=i,this.refPid=a,this.pext=s},c=function(t){var e=t.version,n=t.platform,o=t.device,r=t.appId,i=t.appVersion,s=t.uuid,a=t.sid,c=t.pageInfo,u=t.uid,f=t.ext;this.version=e,this.platform=n,this.device=o,this.appId=r,this.appVersion=i,this.uuid=s,this.sid=a,this.pageInfo=c,this.uid=u,this.ext=f},u=(f.prototype.initLogList=function(){this.logList=this.getLogByStorage();var e=(new Date).getTime();this.logList.forEach(function(t){1===t.sendstate&&6e4<e-t.tsp&&(t.sendstate=3)})},f.prototype.sendLog=function(t){this.logList.push(t),this.saveLogToStorage(),this.startAutoLog()},f.prototype.startAutoLog=function(){if(null===this.setTimeoutId){var t=this;this.setTimeoutId=setTimeout(function(){t.setTimeoutId=null,t.sendLogToServer()},500)}},f.prototype.stopAutoLog=function(){this.setTimeoutId&&clearTimeout(this.setTimeoutId),this.setTimeoutId=null},f.prototype.sendLogToServer=function(){var n=this,e=this.logList.filter(function(t){return 1!==t.sendstate});if(0!==e.length){var t=this.logManage.getLogInfo(e);this.fetch.postLog(t).then(function(){e.forEach(function(t){var e=n.logList.indexOf(t);-1!==e&&n.logList.splice(e,1)}),n.saveLogToStorage()}).catch(function(t){e.forEach(function(t){t.sendstate=2}),n.saveLogToStorage()}),e.forEach(function(t){return t.sendstate=1}),this.saveLogToStorage()}},f.prototype.saveLogToStorage=function(){300<this.logList.length&&(this.logList=this.logList.filter(function(t){return 2!==t.sendstate&&3!==t.sendstate})),this.storage&&this.storage.saveLogItems(this.logList)},f.prototype.getLogByStorage=function(){return this.storage&&this.storage.getLogItems()||[]},f);function f(t){this.logList=[],this.setTimeoutId=null;var e=t.logManage,n=t.fetch,o=t.storage;this.logManage=e,this.fetch=n,this.storage=o,this.initLogList()}function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})+"-"+(new Date).getTime()}function l(t){void 0===t&&(t=28),t=t||10;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz0123456789",n=e.length,o="",r=0;r<t;r++)o+=e.charAt(Math.floor(Math.random()*n));return o}function h(t){return!!/(growingio.com)/i.test(t)}function g(t){var e=[];return function(){if("function"==typeof arguments[0]&&-1===e.indexOf(arguments[0]))e.push(arguments[0]);else for(var t=0;t<e.length;t++)e[t].apply(this,arguments);return this}.bind(t||this)}function v(t,e){if(t){var n="_fasTraceId="+(e||(new Date).getTime());if(/_fasTraceId/.test(t))t=t.replace(/_fasTraceId=([^&]+)/g,n);else{var o=-1===t.indexOf("?")?"?":"&";t=t+o+n}}return t}(e=t||(t={})).PV="PV",e.PO="PO",e.CLICK="CLICK",e[e.BUSINESS=3]="BUSINESS",(r=o||(o={})).TRACK="track",r.PERF="performance",r.ERROR="error",(s=i||(i={})).WEB="web",s.MP="mp",s.HAP="hap";var m=function(t){this.list=[];var e=t.appid,n=t.platform,o=t.uuid,r=t.d_sw,i=t.d_sh,s=t.logList,a=t.ext,c=t.uid;this.appid=e,this.platform=n,this.uuid=o,this.d_sw=r,this.d_sh=i,this.list=s,this.ext=a,this.uid=c,this.tsp=(new Date).getTime()},y=function(t){var e=t.version,n=t.appversion,o=t.sid,r=t.pid,i=t.uid,s=t.url,a=t.ref,c=t.refpid,u=t.pname,f=t.pext,p=t.type,h=t.data,d=t.subtype;this.version=e,this.appversion=n,this.sid=o,this.pid=r,this.uid=i,this.url=s,this.ref=a,this.refpid=c,this.pname=u,this.pext=f,this.type=p,this.data=h,this.subtype=d,this.tsp=(new Date).getTime(),this.id=l(16)},w=(L.prototype.sendTrackLog=function(t,e){this.sendLog(o.TRACK,t,e)},L.prototype.sendTrackPVLog=function(t){this.sendTrackLog("pageview",{type:t})},L.prototype.sendTrackPOLog=function(t){this.sendTrackLog("pageout",{type:t})},L.prototype.sendTrackEvent=function(t,e){this.sendTrackLog(t,e)},L.prototype.sendTrackCustomLog=function(t){this.sendTrackLog("custom",t)},L.prototype.sendErrorLog=function(t,e){e.message&&this.sendLog(o.ERROR,t,e)},L.prototype.sendCustomErrorLog=function(t){t.level=t.level||1,this.sendErrorLog("custom",t)},L.prototype.sendJsErrorLog=function(t){this.sendErrorLog("js",t)},L.prototype.sendPageErrorLog=function(t){this.sendErrorLog("page",t)},L.prototype.sendAjaxErrorLog=function(t){var e="";t.response&&(t.response.message?e=" message:"+t.response.message:t.response.errMsg&&(e=" message:"+t.response.errMsg));var n="AJAX ERROR: status:"+t.status+" "+function(t){return t&&t.indexOf("?")?t.split("?")[0]:t}(t.url)+e;this.sendErrorLog("ajax",{level:1,message:n,error:t})},L.prototype.sendResourceErrorLog=function(t){this.sendErrorLog("resource",t)},L.prototype.sendPerfLog=function(t,e){this.sendLog(o.PERF,t,e)},L.prototype.sendPagePerfLog=function(t){this.sendPerfLog("page",t)},L.prototype.sendAjaxPerfLog=function(t){this.sendPerfLog("ajax",t)},L.prototype.getLogInfo=function(t){var e=this.siteInfo.device,n=new m({appid:this.siteInfo.appId,platform:this.siteInfo.platform,uuid:this.siteInfo.uuid,uid:this.siteInfo.uid,d_sw:e.d_sw,d_sh:e.d_sh,ext:this.siteInfo.ext,logList:t});return d({},n,e)},L.prototype.sendLog=function(t,e,n){var o=new y({version:this.siteInfo.version,appversion:this.siteInfo.appVersion,sid:this.siteInfo.sid,pid:this.siteInfo.pageInfo.pid,uid:this.siteInfo.uid,url:this.siteInfo.pageInfo.url,ref:this.siteInfo.pageInfo.ref,refpid:this.siteInfo.pageInfo.refPid,pname:this.siteInfo.pageInfo.pageName,pext:this.siteInfo.pageInfo.pext,type:t,subtype:e,data:n});this.isDebug?console.log("SEND LOG DATA: "+t+"_"+e,o):this.reportUpload.sendLog(o)},L.prototype.sendLogsNow=function(){this.reportUpload.stopAutoLog(),this.reportUpload.sendLogToServer()},L);function L(t){this.isDebug=!1;var e=t.siteInfo,n=t.fetch,o=t.storage,r=t.isDebug;this.siteInfo=e,this.isDebug=r,this.reportUpload=new u({logManage:this,fetch:n,storage:o})}var T=(_.prototype.init=function(t){if(this.config=t,!this.config.logApi)throw new Error("config.logApi 必填");this.fetch.setApiUrl(this.config.logApi),this.siteInfo=this.getSiteInfo(),this.updateAjaxTrackId(),this.report=this.getReport(),this.initMonitor(),this.config.isDebug&&console.log("ANALYTICS - SiteInfo :",this.siteInfo)},_.prototype.getSiteInfo=function(){return new c({appId:this.config.appId,appVersion:this.config.appVersion,version:"0.2.8",platform:this.platformType,uuid:this.globalUUID,sid:this.globalSessionId,uid:this.config.userId,ext:this.config.ext,device:this.deviceInfo,pageInfo:this.getPageInfo()})},_.prototype.getReport=function(){return new w({siteInfo:this.siteInfo,fetch:this.fetch,storage:this.storage,isDebug:this.config.isDebug})},_.prototype.sendPerfLog=function(t,e){this.report.sendPerfLog(t,e)},_.prototype.sendPagePerfLog=function(t){this.report.sendPagePerfLog(t)},_.prototype.sendAjaxPerfLog=function(t){this.report.sendAjaxPerfLog(t)},_.prototype.sendErrorLog=function(t,e){e.message&&this.report.sendErrorLog(t,e)},_.prototype.sendJsErrorLog=function(e){var n=!0;this.config.errorIgnoreList&&0<this.config.errorIgnoreList.length&&this.config.errorIgnoreList.forEach(function(t){t.test(e.message)&&(n=!1)}),n&&this.report.sendJsErrorLog(e)},_.prototype.sendPageErrorLog=function(t){this.report.sendPageErrorLog(d({level:1},t))},_.prototype.sendAjaxErrorLog=function(t){this.report.sendAjaxErrorLog(t)},_.prototype.sendResourceErrorLog=function(t){this.report.sendResourceErrorLog(t)},_.prototype.sendTrackLog=function(t,e){this.report.sendTrackLog(t,e)},_.prototype.sendTrackPVLog=function(t){this.report.sendTrackPVLog(t)},_.prototype.sendTrackPOLog=function(t){this.report.sendTrackPOLog(t)},_.prototype.sendTrackEvent=function(t,e){this.report.sendTrackEvent(t,e)},_.prototype.sendLogsNow=function(){this.report.sendLogsNow()},_.prototype.updateNewPageInfo=function(){this.siteInfo.pageInfo=this.getPageInfo(),this.updateAjaxTrackId()},_.prototype.updateAjaxTrackId=function(t){this.setAjaxTrackId(this.getTraceId(t))},_.prototype.getTraceId=function(t){var e=t?"_"+t:"";return(new Date).getTime()+"_"+(this.siteInfo.pageInfo.pid+(e||""))},_.prototype.setSiteExt=function(t,e){void 0===e&&(e=!0),this.siteInfo.ext=e?t:d({},this.siteInfo.ext,t)},_.prototype.setUserId=function(t){this.config.userId=t,this.siteInfo.uid=t},_.prototype.setPageExt=function(t,e){void 0===e&&(e=!0);var n=this.siteInfo.pageInfo;n.pext=e?t:d({},n.pext,t)},_.prototype.setCustomTrack=function(t){t.eventname?this.report.sendTrackCustomLog(t):console.error("FAS: setCustomTrack 必传值缺失")},_.prototype.setCustomPvTrack=function(t){void 0===t&&(t=!1),t&&this.updateNewPageInfo(),this.sendTrackPVLog("custom")},_.prototype.setCustomError=function(t){t.message?this.report.sendCustomErrorLog(t):console.error("FAS: setCustomError 必传值缺失")},_.prototype.getGlobalTraceInfo=function(){return{uuid:this.siteInfo&&this.siteInfo.uuid,sid:this.siteInfo&&this.siteInfo.sid,pid:this.siteInfo&&this.siteInfo.pageInfo&&this.siteInfo.pageInfo.pid}},_);function _(t){this.fetch=t.fetch,this.storage=t.storage,this.platformType=t.platformType,this.deviceInfo=t.deviceInfo,this.globalUUID=t.globalUUID,this.globalSessionId=t.globalSessionId}var I=(E.prototype.init=function(){this.performance=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance},E.prototype.getNow=function(){return this.performance.now||this.performance.webkitNow||this.performance.msNow||this.performance.oNow||this.performance.mozNow||function(){return(new Date).getTime()}},E.prototype.getTiming=function(){var e={};if(!this.performance||!this.performance.timing)return e;e=this.performance.timing.toJSON?this.performance.timing.toJSON():this.performance.timing;var t=0;if(this.performance.getEntriesByType){var n=this.performance.getEntriesByType("paint");n&&0<n.length&&(e.firstPaintTime=n[0].startTime)}return e.firstPaintTime||(window.chrome&&window.chrome.loadTimes?(t=1e3*window.chrome.loadTimes().firstPaintTime,e.firstPaintTime=t-e.navigationStart):"number"==typeof e.msFirstPaint?(t=e.msFirstPaint,e.firstPaintTime=t-e.navigationStart):e.firstPaintTime=this.currentTime-e.navigationStart),e.domReadyTime=e.domContentLoadedEventEnd-e.navigationStart,setTimeout(function(){var t=this.performance.timing;e.loadEventEnd=t.loadEventEnd,e.loadEventStart=t.loadEventStart,e.loadTime=e.loadEventEnd-e.navigationStart},0),0===this.imgLoadTime?e.firstScreenTime=e.domReadyTime:e.firstScreenTime=this.imgLoadTime-e.navigationStart,e},E.prototype.getResourceEntries=function(){if(void 0!==this.performance&&this.performance.getEntriesByType){var n=[];return this.performance.getEntriesByType("resource").forEach(function(t){if("xmlhttprequest"!==t.initiatorType&&"fetchrequest"!==t.initiatorType&&"fetch"!==t.initiatorType){var e=t.toJSON?t.toJSON():t;e.loadTime=t.responseEnd-t.requestStart,n.push(e)}}),n}},E.prototype.getMemory=function(){if(void 0!==this.performance){var t=this.performance.memory;if(t)return{jsHeapSizeLimit:t.jsHeapSizeLimit,totalJSHeapSize:t.totalJSHeapSize,usedJSHeapSize:t.usedJSHeapSize}}},E.prototype.getNetwork=function(){var t=window.navigator,e=t.connection||t.mozConnection||t.webkitConnection;if(e)return{type:e.type,effectiveType:e.effectiveType,rtt:e.rtt,downlink:e.downlink||e.downlinkMax}},E.getInstance=function(){return E._instance||(E._instance=new E),E._instance},E);function E(){this.currentTime=Date.now(),this.imgLoadTime=0,this.init()}var b=/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i,x={get:function(t){for(var e=t+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return decodeURIComponent(r.substring(e.length,r.length))}return null},set:function(t,e,n,o,r){var i="",s="",a="";if(o){var c=document.location.hostname.match(b),u=c?c[0]:"";i=u?"; domain=."+u:""}if(n){var f=new Date;f.setTime(f.getTime()+24*n*60*60*1e3),s="; expires="+f.toGMTString()}r&&(a="; secure");var p=t+"="+encodeURIComponent(e)+s+"; path=/"+i+a;return document.cookie=p},remove:function(t,e){x.set(t,"",-1,e)}},P={get:function(t){try{return window.localStorage.getItem(t)}catch(t){P.error(t)}return null},parse:function(t){try{return JSON.parse(P.get(t)||"")||{}}catch(t){}return null},set:function(t,e){try{window.localStorage.setItem(t,e)}catch(t){P.error(t)}},setObj:function(t,e){var n="";try{n=JSON.stringify(e)}catch(t){P.error(t)}n&&P.set(t,n)},remove:function(t){try{window.localStorage.removeItem(t)}catch(t){P.error(t)}},error:function(t){console.error("localStorage error: "+t)}},S={get:function(t){try{return window.sessionStorage.getItem(t)}catch(t){S.error(t)}return null},set:function(t,e){try{window.sessionStorage.setItem(t,e)}catch(t){S.error(t)}},remove:function(t){try{window.sessionStorage.removeItem(t)}catch(t){S.error(t)}},error:function(t){console.error("localStorage error: "+t)}},k="_fas_logitems",A=(C.prototype.saveLogItems=function(t){P.setObj(k,t)},C.prototype.getLogItems=function(){return P.parse(k)||[]},C);function C(){}var N="_fas_uuid",H="_fas_session_id";function j(){var t=S.get(H);return t||(t=function(t){return void 0===t&&(t=28),l(t)+(new Date).getTime()}(),S.set(H,t)),t}var O=function(t,e,n,o){void 0===o&&(o=!1),(O=t.addEventListener?function(t,e,n,o){t.addEventListener(e,n,o)}:function(t,e,n){t.attachEvent("on"+e,n)})(t,e,n,o)};function M(t){t.prototype._addEventListener=t.prototype.addEventListener,t.prototype.addEventListener=function(t,e,n){null==n&&(n=!1),this._addEventListener(t,e,n),this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[t]||(this.eventListenerList[t]=[]),this.eventListenerList[t].push({listener:e,useCapture:n})},t.prototype.getEventListeners=function(t){return this.eventListenerList||(this.eventListenerList={}),null==t?this.eventListenerList:this.eventListenerList[t]},t.prototype.clearEventListeners=function(t){if(this.eventListenerList||(this.eventListenerList={}),null!=t){var e=this.getEventListeners(t);if(null!=e)for(var n=e.length-1;0<=n;--n){var o=e[n];this.removeEventListener(t,o.listener,o.useCapture)}}else for(var r in this.getEventListeners())this.clearEventListeners(r)};var r=Element.prototype.removeEventListener;t.prototype.removeEventListener=function(t,e,n){null==n&&(n=!1),r.call(this,t,e,n),this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[t]||(this.eventListenerList[t]=[]);for(var o=0;o<this.eventListenerList[t].length;o++)if(this.eventListenerList[t][o].listener,this.eventListenerList[t][o].useCapture==n){this.eventListenerList[t].splice(o,1);break}0==this.eventListenerList[t].length&&delete this.eventListenerList[t]}}function R(t){var e=[];do{var n=t.nodeName.toLowerCase();if(n+="["+V(t)+"]",t.hasAttribute("id")&&""!=t.id&&(n+="#"+t.id),t.classList&&0<t.classList.length)for(var o=0;o<t.classList.length;o++)n+="."+t.classList[o];e.unshift(n)}while("html"!=t.nodeName.toLowerCase()&&(t=t.parentNode));return"/"+e.slice(2).join("/")}function V(t){for(var e=0,n=0;n<t.parentNode.childNodes.length;n++){var o=t.parentNode.childNodes[n];if(1===o.nodeType&&"SCRIPT"!==o.nodeName&&(e++,o===t))break}return e}function D(t){var e=t&&t.dataset,n=null;if(e)for(var o in e)e.hasOwnProperty(o)&&/fas/.test(o)&&(n||(n={}),n[o]=e[o]);return n}var U=g,J=(F.prototype.initPageEvent=function(){var n=this;this._initHistoryStateHook(function(t,e){n._historyStateChange({type:t,state:e})})},F.prototype.onLoad=function(t,e){void 0===e&&(e=!1);var n=this;if(this._isLoaded&&e)return t();"complete"===window.document.readyState?(this._isLoaded=!0,t()):O(window,"load",function(){n._isLoaded=!0,t()})},F.prototype.onClick=function(t){O(window.document,"click",t,!0)},F.prototype.onChange=function(t){O(window.document,"change",t,!0)},F.prototype.onHistoryStateChange=function(t){this._historyStateChange(t)},F.prototype.onHashChange=function(t){O(window,"hashchange",function(){t(location.hash)},!0)},F.prototype.onPopState=function(e){O(window,"popstate",function(t){e(t.state)},!0)},F.prototype.onVisibilityChange=function(t){O(window.document,"visibilitychange",function(){t(document.visibilityState)},!0)},F.prototype.onBeforeUnload=function(t){O(window,"beforeunload",t,!0)},F.prototype.onPageHide=function(t){O(window,"pagehide",t,!0)},F.prototype.onPageUnloadFirst=function(e){var n=!1;this.onVisibilityChange(function(t){n||"hidden"!==t||(n=!0,e("visibilityChangeHidden"))}),this.onBeforeUnload(function(){n||(n=!0,e("beforeUnload"))}),this.onPageHide(function(){n||(n=!0,e("pageHide"))}),this.onUnLoad(function(){n||(n=!0,e("unLoad"))})},F.prototype.onUnLoad=function(t){O(window,"unload",t,!0)},F.prototype._initHistoryStateHook=function(o){function t(e){var n=r[e];return function(){var t=n.apply(this,arguments);return o(e,arguments),t}}var r=window.history;r.pushState=t("pushState"),r.replaceState=t("replaceState")},F.getInstance=function(){return F._instance||(F._instance=new F),F._instance},F);function F(){this._historyStateChange=new U,this._isLoaded=!1,this.initPageEvent()}var q=(z.prototype.addErrorHandle=function(t){this._ajaxErrorHandle(t)},z.prototype.getPerformanceHandle=function(t){this._perfHandle(t)},z.prototype.initAjaxHook=function(){var r=this;if("file:"!==window.location.protocol&&window.XMLHttpRequest){var t=window.XMLHttpRequest,e=t.prototype.open;t.prototype.open=function(){return this._islog||(arguments[1]=v(arguments[1],r._traceId)),this._url=arguments[1],this._method=arguments[0],this._beginTime=(new Date).getTime(),e.apply(this,arguments)};var n=t.prototype.send,o=function(t){try{if(!this._islog&&!h(this._url)&&t&&t.target){var e={url:this._url,method:this._method,beginTime:this._beginTime,endTime:(new Date).getTime(),status:t.target.status,response:null};if(r._perfHandle(e),200!==e.status){var n=0===e.status?void 0:t.target.response,o=0===e.status&&t.target.response?"jsErr":"httpErr";r._ajaxErrorHandle(d({response:n,ext:{reqfun:"XMLHttpRequest",ajaxErrorType:o}},e))}}}catch(t){console.error(t)}};t.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",o),this.addEventListener("load",o),this.addEventListener("abort",o);else{var e=this.onreadystatechange;this.onreadystatechange=function(t){4===this.readyState&&o(t),e&&e.apply(this,arguments)}}return n.apply(this,arguments)}}},z.prototype.initFetchHook=function(){var r=this;if(window.fetch){var t=window.fetch;window.fetch=function(){var n=(new Date).getTime();arguments[0]=v(arguments[0],r._traceId);var o=arguments;return t.apply(this,arguments).then(function(t){try{if(!h(o[0])){var e={url:o[0],method:o[1].method,beginTime:n,endTime:(new Date).getTime(),status:t&&t.status};t.ok?r._perfHandle(e):(r._perfHandle(e),r._ajaxErrorHandle(d({response:t,ext:{reqfunc:"fetch"}},e)))}}catch(t){console.error(t)}return t}).catch(function(t){try{h(o[0])||r._ajaxErrorHandle({url:o[0],method:o[1].method,status:t.status,beginTime:n,endTime:(new Date).getTime(),response:t})}catch(t){console.error(t)}throw t})}}},z.prototype.setTrackId=function(t){this._traceId=t},z.getInstance=function(){return z._instance||(z._instance=new z),z._instance},z);function z(){var t=g;this._ajaxErrorHandle=new t,this._perfHandle=new t,this.initAjaxHook(),this.initFetchHook()}var B=(X.prototype.request=function(t){var r=t.url,i=t.method,s=t.data,a=t.header;return i=i.toUpperCase(),new Promise(function(t,e){var n;if(window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new window.ActiveXObject("Microsoft.XMLHTTP")),s&&"POST"===i&&(s=JSON.stringify(s)),n._islog=!0,n.open(i,r,!0),a)for(var o in a)a.hasOwnProperty(o)&&n.setRequestHeader(o,a[o]);n.timeout=2e4,n.ontimeout=function(){e("请求超时!")},n.onerror=function(){e("网络错误!")},n.onabort=function(){e("请求取消")},n.onreadystatechange=function(){4===n.readyState&&(200<=n.status&&n.status<300?t(n.responseText):e(n.status))},n.send("GET"===i?null:s)})},X.prototype.post=function(t,e,n){return n=d({"Content-Type":"text/plain; charset=utf-8;"},n),this.request({url:t,method:"POST",data:e,header:n})},X.prototype.setApiUrl=function(t){this.url=t},X.prototype.postLog=function(t){return this.url?function(){var t=window.navigator.userAgent;return!!/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp|yisouspider|360spider|adsbot|sosospider|sogou web spider|youdaobot)/i.test(t)}()?Promise.resolve():this.post(this.url,t):Promise.reject("URL 不能为空")},X);function X(){}var K,G,W,Y,$=J.getInstance(),Q="_fas_session_page_id",Z="_fas_session_page_url",tt={autoSendPV:!0,enableHashPV:!1,errorIgnoreList:[/script error/i]},et=(n(K=ot,G=W=T),void(K.prototype=null===G?Object.create(G):(nt.prototype=G.prototype,new nt)),ot.prototype.init=function(t){if(!t)throw new Error("初始化 Config 不能为空");var e;this.config=d({},tt,t),W.prototype.init.call(this,this.config),window._fas=this,"function"==typeof Event?e=new Event("onFasInit"):(e=document.createEvent("Event")).initEvent("onFasInit",!0,!0),window.dispatchEvent(e)},ot.prototype.initMonitor=function(){var t=this;M(Element),M(Document),this.initErrorMonitor(),this.initAjaxPerformanceMonitor(),this.initTrackMonitor(),$.onLoad(function(){console.info("FAS - onReady"),t.hasPageLoadReady=!0,t.initPagePerformanceMonitor()}),setTimeout(function(){t.hasPageLoadReady||t.sendPageErrorLog({message:"Page Load Timeout 5s"})},5e3)},ot.prototype.initErrorMonitor=function(){!function(i){var s=window.onerror;window.onerror=function(t,e,n,o,r){i({message:t,level:0,error:{stackInfo:r,url:e,line:n,col:o}}),s&&s.apply(window,arguments)}}(this.sendJsErrorLog.bind(this)),function(o){O(window,"error",function(t){if(t){var e=t.target||t.srcElement;if(!(e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement))return;var n=e.src||e.href;if(n===window.location.href)return;if(n===window.location.href+"#")return;if(n===window.location.href+"/")return;n&&255<n.length&&(n=n.substring(0,255)),o({message:"Resource Load Error: "+e.nodeName+" - "+n,level:0,error:{url:n,nodeName:e.nodeName,outerHTML:e.outerHTML}})}},!0)}(this.sendResourceErrorLog.bind(this)),function(o){O(window,"unhandledrejection",function(t){if(t){var e=t.reason,n=e&&e.message;if(!n)try{n=JSON.stringify(e)}catch(t){console.error(t)}o({message:"Promise Error: "+n,level:0,error:e})}},!0)}(this.sendJsErrorLog.bind(this)),function(e){q.getInstance().addErrorHandle(function(t){e(t)})}(this.sendAjaxErrorLog.bind(this)),this.config.Vue&&this.setEnableVueError(this.config.Vue)},ot.prototype.initTrackMonitor=function(){var e=this;this.config.autoSendPV&&this.sendTrackPVLog("inited"),$.onHistoryStateChange(function(t){window.location.pathname!==e.siteInfo.pageInfo.path?(e.updateNewPageInfo(),e.config.autoSendPV&&e.sendTrackPVLog(t)):e.siteInfo.pageInfo.url=window.location.href}),$.onHashChange(function(t){e.config.enableHashPV&&(e.updateNewPageInfo(),e.config.autoSendPV&&e.sendTrackPVLog("hashChange"))}),$.onPageUnloadFirst(function(t){e.config.autoSendPV&&e.sendTrackPOLog(t),e.sendLogsNow()}),$.onClick(function(t){e.trackClick(t)}),$.onChange(function(t){e.trackValueChange(t)})},ot.prototype.initPagePerformanceMonitor=function(){var t=I.getInstance();this.sendPagePerfLog({memory:t.getMemory(),network:t.getNetwork(),timing:t.getTiming(),resourceList:t.getResourceEntries()})},ot.prototype.initAjaxPerformanceMonitor=function(){var e=this;q.getInstance().getPerformanceHandle(function(t){e.sendAjaxPerfLog(t)})},ot.prototype.setAjaxTrackId=function(t){q.getInstance().setTrackId(t)},ot.prototype.trackClick=function(t,e){var n=l(12);this.updateAjaxTrackId(n);var o=t.target.nodeName.toLowerCase();if("html"!==o&&"body"!==o){var r=[],i=e,s=null,a=t.target;do{var c=a.getEventListeners("click"),u=c&&0<c.length||a.onclick;if(a===t.target||u){var f=R(a),p=this.getNodeTrackInfo(a);r.push({listener:u?"click":void 0,path:f,text:p.text,href:p.href,value:p.value});var h=D(a);h&&(h.fasEventName&&!s&&(s=h.fasEventName,delete h.fasEventName),i=d({},h,i||{}))}}while(void 0!==a.parentNode&&(a=a.parentNode)&&"html"!==a.nodeName.toLowerCase()&&"body"!==a.nodeName.toLowerCase());this.sendTrackEvent("click",{trackid:n,events:r,eventname:s,ext:i,posx:t.x,posy:t.y,offsetx:document.documentElement.scrollTop||document.body.scrollTop,offsety:document.documentElement.scrollLeft||document.body.scrollLeft})}},ot.prototype.trackValueChange=function(t){var e,n=l(12);this.updateAjaxTrackId(n);var o=t.target,r=R(o),i=this.getNodeTrackInfo(o);e={listener:"valuechange_"+o.name,path:r,text:i.text,value:i.value};var s=D(o);this.sendTrackEvent("click",{trackid:n,events:[e],ext:s,offsetx:document.documentElement.scrollTop||document.body.scrollTop,offsety:document.documentElement.scrollLeft||document.body.scrollLeft})},ot.prototype.getNodeTrackInfo=function(t){var e=void 0,n=void 0,o=void 0,r=t.nodeName.toLowerCase();return"input"!==r&&"textarea"!==r&&"select"!==r&&"radio"!==r&&"checkbox"!==r||(o=t.value),t.innerText&&(e=t.innerText.substr(0,100)),"a"===r&&(n=t.href||void 0),{text:e,href:n,value:o}},ot.prototype.getPageInfo=function(){var t=document.referrer&&document.referrer!==location.href?document.referrer:void 0;t=this.siteInfo&&this.siteInfo.pageInfo.url||S.get(Z)||t;var e=this.siteInfo&&this.siteInfo.pageInfo.pid||S.get(Q),n=this.config.parsePathToPageNameFunc&&this.config.parsePathToPageNameFunc(window.location.pathname,window.location.hash,window.location.search),o=new a({pid:l(),pageName:n,url:window.location.href,path:window.location.pathname,ref:t,refPid:e,pext:void 0});return S.set(Z,o.url),S.set(Q,o.pid),o},ot.prototype.setEnableVueError=function(t){this.config.Vue=t,!0!==this.hasHandleVueError&&(this.hasHandleVueError=!0,function(t,r){if(t&&t.config){var i=t.config.errorHandler;t.config.errorHandler=function(t,e,n){console.error(t);var o={info:n};if("[object Object]"===Object.prototype.toString.call(e)){o.componentName=e._isVue?e.$options.name||e.$options._componentTag:e.name;try{o.propsData=JSON.stringify(e.$options.propsData||{}).substr(0,3e3)}catch(t){console.error(t)}}t.metaData=o,r({message:"VUE JS ERROR: "+t.message,level:0,error:t}),i&&i.call(this,t,e,n)}}}(t,this.sendJsErrorLog.bind(this)))},ot.getInstance=function(){return ot._instance||(ot._instance=new ot),ot._instance},ot);function nt(){this.constructor=K}function ot(t){var e=W.call(this,{storage:new A,fetch:new B,platformType:i.WEB,deviceInfo:{d_sw:window.screen.width,d_sh:window.screen.height},globalUUID:function(){var t=P.get(N),e=x.get(N),n=t||e||p();return t||P.set(N,n),e||x.set(N,n,void 0,!0),n}(),globalSessionId:j()})||this;return e.hasPageLoadReady=!1,e.hasHandleVueError=!1,t&&e.init(t),e}function rt(){Y._fasInitConfig?et.getInstance().init(Y._fasInitConfig):Y._fas&&Array.isArray(Y._fas)&&Y._fas[0]&&"init"===Y._fas[0][0]&&Y._fas[0][1]&&et.getInstance().init(Y._fas[0][1])}(Y=window)._fas||Y._fasInitConfig?rt():Y._initFas=rt;var it,st="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};return(function(t,e){t.exports=function(){function u(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=0,e=void 0,r=void 0,s=function(t,e){h[o]=t,h[o+1]=e,2===(o+=2)&&(r?r(d):l())};var t="undefined"!=typeof window?window:void 0,i=t||{},a=i.MutationObserver||i.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var t=setTimeout;return function(){return t(d,1)}}var h=new Array(1e3);function d(){for(var t=0;t<o;t+=2){var e=h[t],n=h[t+1];e(n),h[t]=void 0,h[t+1]=void 0}o=0}var l=void 0;function g(t,e){var n=this,o=new this.constructor(y);void 0===o[m]&&j(o);var r=n._state;if(r){var i=arguments[r-1];s(function(){return N(r,o,i,n._result)})}else A(n,o,t,e);return o}function v(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(y);return x(e,t),e}l=c?function(){return process.nextTick(d)}:a?function(){var t=0,e=new a(d),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():f?function(){var t=new MessageChannel;return t.port1.onmessage=d,function(){return t.port2.postMessage(0)}}():void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?p():function(){e(d)}}catch(t){return p()}}():p();var m=Math.random().toString(36).substring(2);function y(){}var w=void 0,L=1,T=2,_={error:null};function I(t){try{return t.then}catch(t){return _.error=t,_}}function E(t,e,n,o){try{t.call(e,n,o)}catch(t){return t}}function b(t,e,n){e.constructor===t.constructor&&n===g&&e.constructor.resolve===v?function(e,t){t._state===L?S(e,t._result):t._state===T?k(e,t._result):A(t,void 0,function(t){return x(e,t)},function(t){return k(e,t)})}(t,e):n===_?(k(t,_.error),_.error=null):void 0===n?S(t,e):u(n)?function(t,o,r){s(function(e){var n=!1,t=E(r,o,function(t){n||(n=!0,o!==t?x(e,t):S(e,t))},function(t){n||(n=!0,k(e,t))},e._label);!n&&t&&(n=!0,k(e,t))},t)}(t,e,n):S(t,e)}function x(t,e){t===e?k(t,new TypeError("You cannot resolve a promise with itself")):!function(t){var e=typeof t;return null!==t&&("object"==e||"function"==e)}(e)?S(t,e):b(t,e,I(e))}function P(t){t._onerror&&t._onerror(t._result),C(t)}function S(t,e){t._state===w&&(t._result=e,t._state=L,0!==t._subscribers.length&&s(C,t))}function k(t,e){t._state===w&&(t._state=T,t._result=e,s(P,t))}function A(t,e,n,o){var r=t._subscribers,i=r.length;t._onerror=null,r[i]=e,r[i+L]=n,r[i+T]=o,0===i&&t._state&&s(C,t)}function C(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var o=void 0,r=void 0,i=t._result,s=0;s<e.length;s+=3)o=e[s],r=e[s+n],o?N(n,o,r,i):r(i);t._subscribers.length=0}}function N(t,e,n,o){var r=u(n),i=void 0,s=void 0,a=void 0,c=void 0;if(r){if((i=function(t,e){try{return t(e)}catch(t){return _.error=t,_}}(n,o))===_?(c=!0,s=i.error,i.error=null):a=!0,e===i)return void k(e,new TypeError("A promises callback cannot return that same promise."))}else i=o,a=!0;e._state!==w||(r&&a?x(e,i):c?k(e,s):t===L?S(e,i):t===T&&k(e,i))}var H=0;function j(t){t[m]=H++,t._state=void 0,t._result=void 0,t._subscribers=[]}var O=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(y),this.promise[m]||j(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&S(this.promise,this._result))):k(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===w&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,o=n.resolve;if(o===v){var r=I(e);if(r===g&&e._state!==w)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===M){var i=new n(y);b(i,e,r),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},t.prototype._settledAt=function(t,e,n){var o=this.promise;o._state===w&&(this._remaining--,t===T?k(o,n):this._result[e]=n),0===this._remaining&&S(o,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;A(t,void 0,function(t){return n._settledAt(L,e,t)},function(t){return n._settledAt(T,e,t)})},t}();var M=function(){function e(t){this[m]=H++,this._result=this._state=void 0,this._subscribers=[],y!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){x(e,t)},function(t){k(e,t)})}catch(t){k(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return u(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return M.prototype.then=g,M.all=function(t){return new O(this,t).promise},M.race=function(r){var i=this;return n(r)?new i(function(t,e){for(var n=r.length,o=0;o<n;o++)i.resolve(r[o]).then(t,e)}):new i(function(t,e){return e(new TypeError("You must pass an array to race."))})},M.resolve=v,M.reject=function(t){var e=new this(y);return k(e,t),e},M._setScheduler=function(t){r=t},M._setAsap=function(t){s=t},M._asap=s,M.polyfill=function(){var t=void 0;if(void 0!==st)t=st;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=M},M.Promise=M}()}(it={exports:{}},it.exports),it.exports).polyfill(),et}();
